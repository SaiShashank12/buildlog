{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" style="max-width: 100vw; overflow-x: hidden;">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
            <i class="fas fa-chart-line text-primary mr-2"></i>Analytics Dashboard
        </h1>
        <p class="text-gray-600 dark:text-gray-300 mt-2">Visualize your project progress and productivity</p>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Projects -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Projects</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2" id="totalProjects">0</p>
                </div>
                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-full p-3">
                    <i class="fas fa-folder text-blue-600 dark:text-blue-400 text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Total Build Logs -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Build Logs</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2" id="totalLogs">0</p>
                </div>
                <div class="bg-green-100 dark:bg-green-900/30 rounded-full p-3">
                    <i class="fas fa-file-alt text-green-600 dark:text-green-400 text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Active Projects -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Active Projects</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2" id="activeProjects">0</p>
                </div>
                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-full p-3">
                    <i class="fas fa-rocket text-purple-600 dark:text-purple-400 text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- This Week's Logs -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">This Week's Logs</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2" id="weeklyLogs">0</p>
                </div>
                <div class="bg-orange-100 dark:bg-orange-900/30 rounded-full p-3">
                    <i class="fas fa-calendar-week text-orange-600 dark:text-orange-400 text-2xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6" style="max-width: 100%;">
        <!-- Activity Chart -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 min-w-0 transition-colors" style="max-width: 100%; overflow: hidden;">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                <i class="fas fa-calendar-alt text-primary mr-2"></i>Activity Over Time
            </h3>
            <div class="relative h-[300px]" style="max-width: 100%;">
                <canvas id="activityChart"></canvas>
            </div>
        </div>

        <!-- Log Type Distribution -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 min-w-0 transition-colors" style="max-width: 100%; overflow: hidden;">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                <i class="fas fa-chart-pie text-primary mr-2"></i>Log Type Distribution
            </h3>
            <div class="relative h-[300px]" style="max-width: 100%;">
                <canvas id="logTypeChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6" style="max-width: 100%;">
        <!-- Project Activity -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 min-w-0 transition-colors" style="max-width: 100%; overflow: hidden;">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                <i class="fas fa-tasks text-primary mr-2"></i>Logs per Project
            </h3>
            <div style="max-width: 100%; height: 300px; position: relative;">
                <canvas id="projectActivityChart"></canvas>
            </div>
        </div>

        <!-- Weekly Trend -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 min-w-0 transition-colors" style="max-width: 100%; overflow: hidden;">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                <i class="fas fa-chart-line text-primary mr-2"></i>Weekly Activity Trend
            </h3>
            <div style="max-width: 100%; height: 300px; position: relative;">
                <canvas id="weeklyTrendChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Project Status Overview -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors" style="max-width: 100%; overflow: hidden;">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
            <i class="fas fa-info-circle text-primary mr-2"></i>Project Status Overview
        </h3>
        <div style="max-width: 100%; height: 100px; position: relative;">
            <canvas id="projectStatusChart"></canvas>
        </div>
    </div>
</div>

<script>
// Check if dark mode is enabled
function isDarkMode() {
    return document.documentElement.classList.contains('dark');
}

// Get colors based on theme
function getChartColors() {
    const dark = isDarkMode();
    return {
        gridColor: dark ? '#374151' : '#e5e7eb',
        textColor: dark ? '#d1d5db' : '#6b7280',
        tooltipBg: dark ? '#1f2937' : '#ffffff',
        tooltipBorder: dark ? '#374151' : '#e5e7eb'
    };
}

// Fetch analytics data
async function loadAnalytics() {
    try {
        const response = await fetch('/api/analytics');
        const data = await response.json();

        // Update summary cards
        document.getElementById('totalProjects').textContent = data.total_projects;
        document.getElementById('totalLogs').textContent = data.total_logs;
        document.getElementById('activeProjects').textContent = data.active_projects;
        document.getElementById('weeklyLogs').textContent = data.weekly_logs;

        // Create charts
        createActivityChart(data.activity_over_time);
        createLogTypeChart(data.log_type_distribution);
        createProjectActivityChart(data.logs_per_project);
        createWeeklyTrendChart(data.weekly_trend);
        createProjectStatusChart(data.project_status);
    } catch (error) {
        console.error('Error loading analytics:', error);
    }
}

// Activity Over Time Chart
function createActivityChart(data) {
    const colors = getChartColors();
    const ctx = document.getElementById('activityChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Build Logs',
                data: data.values,
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                },
                x: {
                    ticks: {
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                }
            }
        }
    });
}

// Log Type Distribution Chart
function createLogTypeChart(data) {
    const colors = getChartColors();
    const ctx = document.getElementById('logTypeChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: data.labels,
            datasets: [{
                data: data.values,
                backgroundColor: [
                    '#3b82f6',
                    '#10b981',
                    '#f59e0b',
                    '#ef4444',
                    '#8b5cf6'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: colors.textColor
                    }
                }
            }
        }
    });
}

// Project Activity Chart
function createProjectActivityChart(data) {
    const colors = getChartColors();
    const ctx = document.getElementById('projectActivityChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Logs',
                data: data.values,
                backgroundColor: '#6366f1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                },
                x: {
                    ticks: {
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                }
            }
        }
    });
}

// Weekly Trend Chart
function createWeeklyTrendChart(data) {
    const colors = getChartColors();
    const ctx = document.getElementById('weeklyTrendChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Logs',
                data: data.values,
                backgroundColor: '#8b5cf6'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                },
                x: {
                    ticks: {
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                }
            }
        }
    });
}

// Project Status Chart
function createProjectStatusChart(data) {
    const colors = getChartColors();
    const ctx = document.getElementById('projectStatusChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Projects',
                data: data.values,
                backgroundColor: [
                    '#3b82f6',
                    '#10b981',
                    '#ef4444'
                ]
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                },
                y: {
                    ticks: {
                        color: colors.textColor
                    },
                    grid: {
                        color: colors.gridColor
                    }
                }
            }
        }
    });
}

// Load analytics on page load
document.addEventListener('DOMContentLoaded', loadAnalytics);
</script>
{% endblock %}
